"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[150],{87774:function(e,n,t){var r=t(70865),o=t(96670),i=t(87394),s=t(52322),a=t(11978),d=t(85313),u=t(65105),c={check:(0,a.css)({display:"inline-block",marginLeft:4,marginTop:-2})};n.Z=(0,u.Z)((function(e){var n=e.description,t=e.verified,a=e.t,u=e.textColor,l=(0,i.Z)((0,d.useColorContext)(),1)[0];return(0,s.jsxs)("span",(0,o.Z)((0,r.Z)({title:t&&a("styleguide/comment/header/verifiedCredential",void 0,"")||void 0},u&&l.set("color",t?"text":"textSoft")),{children:[n,t&&(0,s.jsx)(d.CheckIcon,(0,r.Z)({},c.check,u&&l.set("fill","primary")))]}))}))},28597:function(e,n,t){t.d(n,{Z:function(){return Oe}});var r=t(98788),o=t(70865),i=t(96670),s=t(5163),a=t(52322),d=t(2784),u=t(85313),c=t(65105),l=t(98918),m=t(13980),f=t.n(m),v=t(16459),p=t(87394),h=t(26426),g=t.n(h),y=t(57956),C=t(92228),x=t(57800),I=t(55215),Z=t(69359);function b(){var e=(0,C.Z)(["\n  mutation submitComment(\n    $discussionId: ID!\n    $parentId: ID\n    $id: ID!\n    $content: String!\n    $tags: [String!]!\n  ) {\n    submitComment(\n      id: $id\n      discussionId: $discussionId\n      parentId: $parentId\n      content: $content\n      tags: $tags\n    ) {\n      ...Comment\n      discussion {\n        id\n        userPreference {\n          notifications\n        }\n        userWaitUntil\n      }\n    }\n  }\n  ","\n"]);return b=function(){return e},e}var j=(0,x.Ps)(b(),I.Z),D=(0,Z.G2)(j),P=t(41063),T=t(76665),w=t(95064);var S=function(){var e=(0,p.Z)(D(),1)[0],n=(0,l.D)(),t=n.orderBy,o=n.focusId,i=n.activeTag,a=n.depth;return function(){var n=(0,r.Z)((function(n,r,d){var u,c,l;return(0,s.__generator)(this,(function(s){return u=d.discussionId,c=d.parentId,l=g()(),[2,e({variables:{id:l,content:n,discussionId:u,parentId:c,tags:r},update:function(e,n){var r=n.data.submitComment,s={discussionId:u,orderBy:t,depth:a,focusId:o,activeTag:i},d=e.readQuery({query:P.T,variables:s});e.writeQuery({query:P.T,variables:s,data:(0,T.ZP)(d,(0,w.rX)({comment:r,activeTag:i,initialParentId:c}))})}}).catch(y.C)]}))}));return function(e,t,r){return n.apply(this,arguments)}}()},A=t(33379),O=t(22917);var k=function(){var e=(0,p.Z)((0,A.D)(O.hp),1)[0];return function(n,t,r){return e({variables:{commentId:n,content:t,tags:r}}).catch(y.C)}},R=t(70370),$=t(11978),B={container:(0,$.css)({display:"flex"})},L=function(e){var n=e.t,t=e.isReply,r=void 0!==t&&t;return(0,a.jsxs)("div",(0,i.Z)((0,o.Z)({},B.container),{children:[(0,a.jsx)(u.IconButton,{Icon:u.TextFormatIcon,href:"/markdown",target:"_blank",title:n("components/Discussion/markdown/title")}),r&&(0,a.jsx)(u.IconButton,{size:20,Icon:u.EtiquetteIcon,href:"/etikette",target:"_blank",title:n("components/Discussion/etiquette")})]}))};L.propTypes={t:f().func.isRequired,isReply:f().bool};var E=(0,c.Z)(L),H=t(56995),M=t(18750),N=t(47059),_=t(39097),F=t.n(_),V=function(e){var n,t=e.children,r=e.isRoot,o=e.showPayNotes,i=(0,H.iS)().inNativeIOSApp,s=(0,l.D)().discussion,d=(0,M.Pi)().hasActiveMembership,m=(0,c.$)().t,f=(0,u.useCurrentMinute)(),v=r&&!!(null===s||void 0===s||null===(n=s.rules)||void 0===n?void 0:n.disableTopLevelComments),p=!o||i;if(!s||v)return null;if(s.closed)return(0,a.jsx)(N.Z,{style:{padding:"15px 20px"},children:m("discussion/closed")});if(!(null===s||void 0===s?void 0:s.userCanComment))return p||d?null:(0,a.jsx)(N.Z,{style:{padding:"15px 20px"},children:(0,a.jsx)(u.Interaction.P,{children:m.elements("submitComment/notEligible",{pledgeLink:(0,a.jsx)(F(),{href:"/angebote",passHref:!0,children:(0,a.jsx)(u.Editorial.A,{children:m("submitComment/notEligible/pledgeText")})},"pledge")},"")})});var h,g=s.userWaitUntil&&new Date(s.userWaitUntil);return g&&g>new Date?(0,a.jsx)(N.Z,{style:{padding:"15px 20px"},children:(0,a.jsx)(u.Interaction.P,{children:m("styleguide/CommentComposer/wait",{time:(h=g,(0,u.timeahead)(m,(f-Date.parse(h))/1e3))})})}):(0,a.jsx)(a.Fragment,{children:t})},W=t(56675);function U(){var e=(0,C.Z)(["\n  query commentPreview(\n    $discussionId: ID!\n    $content: String!\n    $parentId: ID\n    $id: ID\n    $tags: [String!]\n  ) {\n    commentPreview(\n      content: $content\n      discussionId: $discussionId\n      parentId: $parentId\n      id: $id\n      tags: $tags\n    ) {\n      id\n      content\n      contentLength\n      tags\n      updatedAt\n      createdAt\n      embed {\n        ... on LinkPreview {\n          url\n          title\n          description\n          imageUrl\n          imageAlt\n          siteName\n          siteImageUrl\n          updatedAt\n          __typename\n        }\n        ... on TwitterEmbed {\n          id\n          url\n          text\n          html\n          userName\n          userScreenName\n          userProfileImageUrl\n          image\n          createdAt\n          __typename\n        }\n      }\n    }\n  }\n"]);return U=function(){return e},e}var q=(0,x.Ps)(U()),z=t(77069);var G=function(){var e=(0,l.D)().id,n=(0,W.x)().query;return function(){var t=(0,r.Z)((function(t){return(0,s.__generator)(this,(function(r){switch(r.label){case 0:return[4,n({query:q,variables:(0,i.Z)((0,o.Z)({},t),{discussionId:e})}).then((function(e){var n;return null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.commentPreview})).catch(z.V)];case 1:return[2,r.sent()]}}))}));return function(e){return t.apply(this,arguments)}}()},Q={showPayNotes:f().bool,isRoot:f().bool,onClose:f().func,commentId:f().string,parentId:f().string,initialText:f().string,initialTagValue:f().string,initialActiveState:f().bool,placeholder:f().string},K=function(e){var n=e.showPayNotes,t=e.isRoot,m=void 0!==t&&t,f=e.onClose,p=e.commentId,h=e.parentId,g=e.initialText,y=e.initialTagValue,C=e.initialActiveState,x=e.placeholder,I=(0,c.$)().t,Z=(0,l.D)(),b=Z.id,j=Z.discussion,D=Z.overlays,P=Z.activeTag,T=j.tags,w=j.rules,A=j.displayAuthor,O=D.preferencesOverlay,$=(0,R.Z)(b),B=$.preferences,L=$.updateDiscussionPreferencesHandler,H=S(),M=k(),N=G(),_=(0,d.useMemo)((function(){var e,n,t,r,o,i,s,a;return!B||(null===B||void 0===B||null===(e=B.discussion)||void 0===e||null===(n=e.userPreference)||void 0===n?void 0:n.notifications)||(null===B||void 0===B||null===(t=B.discussion)||void 0===t||null===(r=t.userPreference)||void 0===r?void 0:r.anonymity)||(null===B||void 0===B||null===(o=B.discussion)||void 0===o||null===(i=o.userPreference)||void 0===i?void 0:i.credential)?null:null===B||void 0===B||null===(s=B.me)||void 0===s||null===(a=s.credentials)||void 0===a?void 0:a.find((function(e){return e.isListed}))}),[B]),F=(0,d.useState)(!(!g&&!C)),W=F[0],U=F[1];(0,d.useEffect)((function(){(0,u.readDiscussionCommentDraft)(b,h)&&U(!0)}),[b,h]);var q=function(){var e=(0,r.Z)((function(e,n){var t;return(0,s.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,9,,10]),_?[4,L(!1,_.description)]:[3,2];case 1:r.sent(),r.label=2;case 2:return p||h?[3,4]:[4,H(e,n,{discussionId:b,parentId:h})];case 3:return t=r.sent(),[3,8];case 4:return p||!h?[3,6]:[4,H(e,[],{discussionId:b,parentId:h})];case 5:return t=r.sent(),[3,8];case 6:return[4,M(p,e,n)];case 7:t=r.sent(),r.label=8;case 8:return[2,{ok:t}];case 9:return[2,{error:r.sent()}];case 10:return[2]}}))}));return function(n,t){return e.apply(this,arguments)}}();return(0,a.jsx)(V,{isRoot:m,showPayNotes:n,children:W?(0,a.jsx)(u.CommentComposer,{t:I,isRoot:m,discussionId:j.id,parentId:h,commentId:p,onSubmit:function(e){var n=e.text,t=e.tags;return q(n,void 0===t?[]:t)},onSubmitLabel:I(g?"styleguide/comment/edit/submit":h?"styleguide/CommentComposer/answer":"submitComment/rootSubmitLabel"),onClose:function(){U(!1),f&&f()},onOpenPreferences:function(){return O.handleOpen(_)},onPreviewComment:N,hintValidators:(0,v.Cf)(I),secondaryActions:(0,a.jsx)(E,{isReply:!!h}),displayAuthor:(0,i.Z)((0,o.Z)({},A),{credential:(null===A||void 0===A?void 0:A.credential)||_}),placeholder:x,maxLength:null===w||void 0===w?void 0:w.maxLength,tags:T,initialText:g,initialTagValue:!h&&(null===T||void 0===T?void 0:T.length)>0?null!==y&&void 0!==y?y:P:void 0}):(0,a.jsx)(u.CommentComposerPlaceholder,{t:I,displayAuthor:null!==A&&void 0!==A?A:{},onClick:function(){return U(!0)},placeholder:x})})},X=K;K.propTypes=Q;var J={emptyDiscussion:(0,$.css)({margin:"20px 0"})},Y=function(){var e=(0,c.$)().t;return(0,a.jsx)("div",(0,i.Z)((0,o.Z)({},J.emptyDiscussion),{children:e("components/Discussion/empty")}))},ee=t(99330);var ne=function(){var e=(0,p.Z)((0,A.D)(O.NA),1)[0],n=(0,p.Z)((0,A.D)(O.C4),1)[0],t=(0,p.Z)((0,A.D)(O.eK),1)[0];return{upVoteCommentHandler:function(n){return e({variables:{commentId:n}}).catch(y.C)},downVoteCommentHandler:function(e){return n({variables:{commentId:e}}).catch(y.C)},unVoteCommentHandler:function(e){return t({variables:{commentId:e}}).catch(y.C)}}};var te=function(){var e=(0,p.Z)((0,A.D)(O.lR),1)[0];return function(n){return e({variables:{commentId:n}}).catch(y.C)}},re=t(47842),oe=t(42838),ie=t(11097),se=2592e6;function ae(e){var n=Object.keys(e).reduce((function(n,t){return n[t]=e[t].toISOString(),n}),{});return JSON.stringify(n)}var de=(0,ie.Z)("local-comment-reports");function ue(){var e=(0,p.Z)(de(null),2),n=e[0],t=e[1],r=(0,d.useState)({}),s=r[0],a=r[1];return(0,d.useEffect)((function(){if(n){var e=function(e){try{if(null!=e&&(0,oe.Z)(JSON.parse(e),Object)){var n=JSON.parse(e);return Object.keys(n).reduce((function(e,t){return e[t]=new Date(n[t]),e}),{})}}catch(t){return{}}}(n);if(a(e),function(e){return Object.keys(e).some((function(n){var t=new Date(e[n]);return(new Date).getTime()-t.getTime()>se}))}(e)){var r=Object.keys(e).reduce((function(n,t){var r=new Date(e[t]);return(new Date).getTime()-r.getTime()<se&&(n[t]=r),n}),{});t(ae(r))}}}),[n]),{addLocalCommentReport:function(e){var n=(0,i.Z)((0,o.Z)({},s),(0,re.Z)({},e,new Date));return a(n),t(ae(n)),!0},checkIfAlreadyReported:(0,d.useMemo)((function(){return function(e){return Object.keys(s).includes(e)}}),[s])}}var ce=function(){var e=(0,p.Z)((0,A.D)(O.iO),1)[0],n=(0,M.Pi)().me,t=ue().addLocalCommentReport;return function(r){return e({variables:{commentId:r}}).then((function(e){return n||t(r),e})).catch(y.C)}},le=t(49164),me=(0,le.i$)("%d.%m.%Y"),fe=(0,le.i$)("%H:%M");var ve=function(e){var n=e.t,t=e.comment,o=e.setEditMode,i=e.roles,a=e.actions,d=e.checkIfAlreadyReported,c=[];if(a.reportCommentHandler&&t.published&&t.userCanReport){var l=!!d&&d(t.id);c.push({icon:u.ReportIcon,label:t.numReports&&t.numReports>0?n("styleguide/CommentActions/reportWithAmount",{amount:t.numReports}):t.userReportedAt||l?n("styleguide/CommentActions/reported"):n("styleguide/CommentActions/report"),disabled:!!t.userReportedAt||l,onClick:(0,r.Z)((function(){return(0,s.__generator)(this,(function(e){switch(e.label){case 0:return window.confirm(n("styleguide/CommentActions/reportMessage"))?[4,a.reportCommentHandler(t.id)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))})}i.includes("editor")&&a.featureCommentHandler&&t.published&&c.push({icon:u.FeaturedIcon,label:t.featuredAt?n("styleguide/CommentActions/featured",{date:me(new Date(t.featuredAt)),time:fe(new Date(t.featuredAt))}):n("styleguide/CommentActions/feature"),onClick:(0,r.Z)((function(){return(0,s.__generator)(this,(function(e){switch(e.label){case 0:return[4,a.featureCommentHandler(t)];case 1:return e.sent(),[2]}}))}))}),o&&t.userCanEdit&&!t.adminUnpublished&&c.push({icon:u.EditIcon,label:n("styleguide/CommentActions/edit"),onClick:function(){return o(!0)}});var m=i.includes("admin")||i.includes("moderator");return a.unpublishCommentHandler&&t.published&&!t.adminUnpublished&&(m||t.userCanEdit)&&c.push({icon:u.UnpublishIcon,label:n("styleguide/CommentActions/unpublish"),onClick:(0,r.Z)((function(){var e;return(0,s.__generator)(this,(function(r){switch(r.label){case 0:return e=n("styleguide/CommentActions/unpublish/confirm".concat(t.userCanEdit?"":"/admin"),{name:t.displayAuthor.name}),window.confirm(e)?[3,1]:[2];case 1:return[4,a.unpublishCommentHandler(t.id)];case 2:return[2,r.sent()];case 3:return[2]}}))}))}),c},pe=function(e){var n,t=e.comment,r=e.tagMappings,o=(0,d.useState)(!1),i=o[0],s=o[1],m=(0,c.$)().t,f=(0,M.Pi)().me,v=(0,l.D)(),p=v.discussion,h=v.overlays.shareOverlay.shareHandler,g=ne(),y=g.upVoteCommentHandler,C=g.downVoteCommentHandler,x=g.unVoteCommentHandler,I=te(),Z=ce(),b=ue().checkIfAlreadyReported,j=(0,d.useMemo)((function(){var e;return ve({comment:t,actions:{unpublishCommentHandler:I,reportCommentHandler:Z},roles:null!==(e=null===f||void 0===f?void 0:f.roles)&&void 0!==e?e:[],t:m,setEditMode:s,checkIfAlreadyReported:b})}),[t,null===f||void 0===f?void 0:f.roles,m,I,Z,b]),D=(0,d.useMemo)((function(){var e,n,r=null!==(n=null===p||void 0===p||null===(e=p.comments)||void 0===e?void 0:e.focus)&&void 0!==n?n:null;return r&&r.id===t.id}),[null===p||void 0===p?void 0:p.comments,t]);return i?(0,a.jsx)(X,{isRoot:!0,onClose:function(){return s(!1)},commentId:t.id,initialText:t.text,initialTagValue:null===t||void 0===t||null===(n=t.tags)||void 0===n?void 0:n[0],placeholder:m("components/Discussion/Statement/Placeholder")}):(0,a.jsx)(u.StatementNode,{comment:t,t:m,actions:{handleShare:h},voteActions:{handleUpVote:y,handleDownVote:C,handleUnVote:x},menuItems:j,tagMappings:r,isHighlighted:D,disableVoting:!p.userCanComment,CommentLink:ee.ZP})},he=t(5632),ge=function(e){var n,t,r,o,i,s=e.CommentComponent,m=void 0===s?u.CommentNode:s,f=e.comment,v=e.isLast,p=e.isBoard,h=e.inRootCommentOverlay,g=(0,c.$)().t,y=(0,M.Pi)().me,C=(0,he.useRouter)(),x=(0,l.D)(),I=x.id,Z=x.discussion,b=x.fetchMore,j=x.overlays,D=j.shareOverlay,P=j.featureOverlay,T=f.id,w=(0,d.useState)(!1),S=w[0],A=w[1],O=(0,d.useState)(!1),k=O[0],R=O[1];(0,d.useEffect)((function(){T&&(0,u.readDiscussionCommentDraft)(I,T)&&R(!0)}),[I,T]);var $,B=ne(),L=ce(),E=te(),H=ue().checkIfAlreadyReported,N=(0,d.useMemo)((function(){return ve({t:g,comment:f,setEditMode:A,roles:null!==($=null===y||void 0===y?void 0:y.roles)&&void 0!==$?$:[],actions:{reportCommentHandler:L,unpublishCommentHandler:E,featureCommentHandler:P.handleOpen},checkIfAlreadyReported:H})}),[g,f,A,null===y||void 0===y?void 0:y.roles,L,E,P.handleOpen,H]),_=null===Z||void 0===Z||null===(n=Z.comments)||void 0===n||null===(t=n.pageInfo)||void 0===t?void 0:t.endCursor,F=(0,d.useCallback)((function(){if(p&&T){var e=(0,ee.x2)(Z);if(e)return e.query.parent=T,C.push(e)}return b({discussionId:I,parentId:T,after:_})}),[I,T,_,b,p]);return(0,a.jsxs)(m,{t:g,comment:f,CommentLink:ee.ZP,actions:{handleReply:Z.userCanComment?function(){return R(!0)}:void 0,handleLoadReplies:F,handleShare:D.shareHandler},voteActions:{handleUpVote:B.upVoteCommentHandler,handleDownVote:B.downVoteCommentHandler,handleUnVote:B.unVoteCommentHandler},menuItems:N,userCanComment:null===Z||void 0===Z?void 0:Z.userCanComment,userWaitUntil:null===Z||void 0===Z?void 0:Z.userWaitUntil,editComposer:(null===f||void 0===f?void 0:f.userCanEdit)&&S&&(0,a.jsx)(X,{onClose:function(){return A(!1)},isRoot:0===f.parentIds.length,commentId:f.id,initialText:f.text,initialTagValue:null===f||void 0===f||null===(r=f.tags)||void 0===r?void 0:r[0]}),focusId:null===Z||void 0===Z||null===(o=Z.comments)||void 0===o||null===(i=o.focus)||void 0===i?void 0:i.id,isLast:v,inRootCommentOverlay:h,children:[(null===Z||void 0===Z?void 0:Z.userCanComment)&&k&&(0,a.jsx)(X,{onClose:function(){return R(!1)},parentId:T,initialActiveState:!0}),!p&&f.comments.nodes.map((function(e,n){return(0,a.jsx)(ge,{comment:e,isLast:n===f.comments.nodes.length-1},e.id)}))]})},ye=ge,Ce=function(e){var n=e.comments,t=void 0===n?[]:n,r=e.documentMeta,o=e.inRootCommentOverlay,i=e.discussion;if(0===t.length)return(0,a.jsx)(Y,{});if("statements"===(null===r||void 0===r?void 0:r.discussionType)){var s,d=null!==(s=null===r||void 0===r?void 0:r.tagMappings)&&void 0!==s?s:[];return(0,a.jsx)(a.Fragment,{children:t.map((function(e){return(0,a.jsx)(pe,{comment:e,tagMappings:d},e.id)}))})}return i.isBoard&&!o?(0,a.jsx)(a.Fragment,{children:t.map((function(e){return(0,a.jsx)(ye,{CommentComponent:u.BoardComment,comment:e,isBoard:!0},e.id)}))}):(0,a.jsx)(a.Fragment,{children:t.map((function(e,n){return(0,a.jsx)(ye,{comment:e,isLast:n===t.length-1,inRootCommentOverlay:o},e.id)}))})},xe=t(50930),Ie=t(82770),Ze={reloadLink:(0,$.css)({display:"flex",flexDirection:"row-reverse",lineHeight:(0,u.pxToRem)("25px"),fontSize:(0,u.pxToRem)("16px")})},be=function(e){var n,t=e.documentMeta,m=(0,c.$)().t,f=(0,he.useRouter)(),v=(0,l.D)(),p=v.discussion,h=v.refetch,g=v.orderBy,y=null===p||void 0===p||null===(n=p.comments)||void 0===n?void 0:n.resolvedOrderBy,C=null===t||void 0===t?void 0:t.discussionType,x=null===p||void 0===p?void 0:p.isBoard,I=(0,d.useMemo)((function(){var e;return"statements"===C?e=["DATE","VOTES"]:(e=["DATE","VOTES","REPLIES"],x&&(e=["HOT"].concat((0,xe.Z)(e)))),e}),[C,x]),Z=function(){var e=(0,r.Z)((function(e){var n;return(0,s.__generator)(this,(function(t){switch(t.label){case 0:return e.preventDefault(),(n=(0,ee.x2)(p))?[4,f.replace(n)]:[3,3];case 1:return t.sent(),[4,h({focusId:void 0})];case 2:return t.sent(),[3,5];case 3:return[4,h()];case 4:t.sent(),t.label=5;case 5:return[2]}}))}));return function(n){return e.apply(this,arguments)}}();return(0,a.jsxs)("div",{children:[(0,a.jsx)(u.Scroller,{children:I.map((function(e){return(0,a.jsx)(F(),{href:(0,Ie.MZ)(f,{order:e}),scroll:!1,prefetch:!1,passHref:!0,children:(0,a.jsx)(u.TabButton,{border:!1,text:m("components/Discussion/OrderBy/".concat(e)),isActive:e===(null!==y&&void 0!==y?y:g)})},e)}))}),Z&&(0,a.jsx)("div",{children:(0,a.jsx)(u.A,(0,i.Z)((0,o.Z)({},Ze.reloadLink),{href:(0,ee.No)(p),onClick:Z,children:m("components/Discussion/reload")}))})]})},je={container:(0,$.css)({position:"sticky",zIndex:10,margin:"24px 0"}),hr:(0,$.css)({margin:0,display:"block",border:0,position:"absolute",bottom:0,height:1,left:0,right:0}),tagLinkContainer:(0,$.css)({padding:"15px 0 10px",marginRight:10,whiteSpace:"nowrap"})},De=function(e){var n=e.tag,t=e.commentCount,r=(0,he.useRouter)(),s=n===r.query.tag,d=(0,Ie.MZ)(r,{tag:s?void 0:n});return(0,a.jsx)("div",(0,i.Z)((0,o.Z)({},je.tagLinkContainer),{children:(0,a.jsx)(F(),{href:d,scroll:!1,prefetch:!1,passHref:!0,children:(0,a.jsx)("a",{children:(0,a.jsx)(u.FormatTag,{color:s?"text":"textSoft",label:n||"Alle",count:t})})})}))},Pe=function(e){var n,t=e.discussion,r=(0,p.Z)((0,u.useColorContext)(),1)[0],s=(0,p.Z)((0,u.useHeaderHeight)(),1)[0],c=(0,he.useRouter)().query.tag,l=(0,d.useState)(!1),m=l[0],f=l[1];if((0,d.useEffect)((function(){var e=function(){f(window.innerWidth<=680)};return window.addEventListener("resize",e),e(),function(){window.removeEventListener("resize",e)}}),[]),!(null===(n=t.tags)||void 0===n?void 0:n.length))return null;var v=[void 0].concat((0,xe.Z)(t.tags)),h=t.tagBuckets,g=t.allComments.totalCount;return(0,a.jsxs)("div",(0,i.Z)((0,o.Z)({},je.container,r.set("background","default")),{style:(0,o.Z)({top:s},m&&{marginLeft:-15,marginRight:-15}),children:[(0,a.jsx)(u.Scroller,{innerPadding:m?15:0,activeChildIndex:v.findIndex((function(e){return e===c})),children:v.map((function(e,n){var t;return(0,a.jsx)(De,{tag:e,commentCount:e?(null===(t=h.find((function(n){return n.value===e})))||void 0===t?void 0:t.count)||0:g},e||n)}))}),(0,a.jsx)("hr",(0,o.Z)({},je.hr,r.set("backgroundColor","divider")))]}))};var Te=function(e){var n=e.nodes,t=e.pageInfo,r=e.directTotalCount,s=e.totalCount,a=function(e){return(0,i.Z)((0,o.Z)({},e),{comments:(0,i.Z)((0,o.Z)({},e.comments),{nodes:d(e.id)})})},d=function(e){return n.filter((function(n){return n.parentIds[n.parentIds.length-1]===e})).map(a)};return{totalCount:s,directTotalCount:r,pageInfo:t,nodes:n.filter((function(e){return 0===e.parentIds.length})).map(a)}},we=t(11408);var Se=function(){var e=function(e){setTimeout((function(){(0,we.X)(e)}),50)},n=function(n){f(new Error(n)),a(!1);var t="[data-discussion-id='".concat(g.id,"']");e(t)},t=(0,d.useState)(null),r=t[0],o=t[1],i=(0,d.useState)(!1),s=i[0],a=i[1],u=(0,d.useState)(null),m=u[0],f=u[1],v=(0,c.$)().t,p=(0,l.D)(),h=p.loading,g=p.discussion,y=p.focusId,C=p.fetchMore;return(0,d.useEffect)((function(){y&&y!==r&&(o(y),a(!0),f(null))}),[y,r]),(0,d.useEffect)((function(){var t,o,i,d;if(s&&!h&&g){var u=g.comments.nodes.find((function(e){return e.id===r}));if(!r||(null===(t=g.comments)||void 0===t?void 0:t.focus))if(u||0!==g.comments.focus.parentIds.length){if(u){a(!1);var c="[data-comment-id='".concat(r,"']");e(c)}else if((null===(o=g.comments)||void 0===o||null===(i=o.focus)||void 0===i||null===(d=i.parentIds)||void 0===d?void 0:d.length)>0){var l=Array.from(g.comments.focus.parentIds).reverse(),m=l.find((function(e){return g.comments.nodes.find((function(n){return n.id===e}))}));if(!m)return void n(v("discussion/focus/missing"));var p=l.indexOf(m)+1;C({discussionId:g.id,parentId:m,after:g.comments.pageInfo.endCursor,depth:p}).catch(z.V).catch(f)}}else n(v("discussion/focus/missing"));else n(v("discussion/focus/notFound"))}}),[g,h,s,r]),{loading:g&&s,error:m}},Ae={commentsWrapper:(0,$.css)({marginTop:(0,u.pxToRem)(20)})},Oe=function(e){var n=e.documentMeta,t=e.inRootCommentOverlay,m=e.showPayNotes,f=(0,c.$)().t,v=(0,l.D)(),p=v.discussion,h=v.loading,g=v.error,y=v.fetchMore,C=Se().error,x=(0,d.useMemo)((function(){return p?Te(null===p||void 0===p?void 0:p.comments):{totalCount:0,directTotalCount:0,pageInfo:{},nodes:[]}}),[p]),I=function(){var e=(0,r.Z)((function(){var e,n;return(0,s.__generator)(this,(function(t){switch(t.label){case 0:return p?(e=p.comments.nodes[p.comments.nodes.length-1],n=p.comments.pageInfo.endCursor,[4,y({after:n,appendAfter:e.id})]):[2];case 1:return t.sent(),[2]}}))}));return function(){return e.apply(this,arguments)}}();return(0,a.jsx)(u.Loader,{loading:h,error:g||(h||p?void 0:f("discussion/missing")),render:function(){return(0,a.jsxs)(a.Fragment,{children:[!t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Pe,{discussion:p}),(0,a.jsx)(X,{isRoot:!0,placeholder:"statements"===(null===n||void 0===n?void 0:n.discussionType)?f("components/Discussion/Statement/Placeholder"):void 0,showPayNotes:m})]}),(0,a.jsxs)("div",(0,i.Z)((0,o.Z)({},Ae.commentsWrapper),{children:[!t&&(0,a.jsx)(be,{documentMeta:n}),(0,a.jsx)(u.DiscussionCommentsWrapper,{t:f,loadMore:I,moreAvailableCount:x.directTotalCount-x.nodes.length,tagMappings:null===n||void 0===n?void 0:n.tagMappings,errorMessage:null===C||void 0===C?void 0:C.message,children:(0,a.jsx)(Ce,{comments:x.nodes,discussion:p,inRootCommentOverlay:t,documentMeta:n})})]}))]})}})}},98918:function(e,n,t){t.d(n,{D:function(){return i}});var r=t(2784),o=t(85313);n.Z=o.DiscussionContext;var i=function(){return(0,r.useContext)(o.DiscussionContext)}},20150:function(e,n,t){t.d(n,{Z:function(){return fe}});var r=t(52322),o=t(37365),i=t(5632),s=t(2784),a=t(22917),d=t(26313),u=t(95064),c=t(41063);var l=function(e,n){var t=(0,c.r)({variables:{discussionId:e,orderBy:n.orderBy,depth:n.depth,focusId:n.focusId,activeTag:n.activeTag,parentId:n.parentId,includeParent:n.includeParent}}),r=t.data,o=(void 0===r?{}:r).discussion,i=t.error,l=t.loading,m=t.fetchMore,f=t.subscribeToMore,v=t.refetch,p=t.previousData,h=n.parentId,g=null===o||void 0===o?void 0:o.id;return(0,s.useEffect)((function(){if(g)return f({document:a.Wb,variables:{discussionId:g},updateQuery:function(e,t){var r=t.subscriptionData;if(r.data&&"CREATED"===r.data.comment.mutation){var o=r.data.comment.node;return h&&!o.parentIds.includes(h)?e:0===e.discussion.comments.totalCount?(0,d.Z)(e,(0,u.rX)({comment:o,initialParentId:h,activeTag:n.activeTag})):(0,d.Z)(e,(0,u.U$)({comment:o,initialParentId:h}))}return e}})}),[g,h]),{discussion:o||(null===p||void 0===p?void 0:p.discussion),loading:l,error:i,refetch:v,fetchMore:function(t){var r=t.parentId,o=t.after,i=t.appendAfter,s=t.depth,a=t.includeParent;return m({variables:{discussionId:e,parentId:r,after:o,orderBy:n.orderBy,activeTag:n.activeTag,depth:s||3,includeParent:a},updateQuery:function(e,n){var t=n.fetchMoreResult.discussion;return(0,d.Z)(e,(0,u.vu)({parentId:r,appendAfter:i,comments:t.comments}))}})}}};var m=function(){var e=(0,s.useState)(!1),n=e[0],t=e[1],r=(0,s.useState)(null),o=r[0],i=r[1];return{data:o,open:n,setOpen:t,handleOpen:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i(e),t(!0)},handleClose:function(){t(!1),i(null)}}},f=t(70865),v=t(96670),p=t(13980),h=t.n(p),g=t(58332),y=t.n(g),C=t(65105),x=t(98559),I=y()(C.Z)((function(e){var n=e.t,t=e.onClose,o=e.url,i=e.title;return(0,r.jsx)(x.Z,{onClose:t,url:o,title:n("discussion/share/title"),tweet:"",emailSubject:n("discussion/share/emailSubject",{title:i}),emailBody:"",emailAttachUrl:o})})),Z=t(98918),b=t(98788),j=t(47842),D=t(87394),P=t(5163),T=t(85313),w=t(9252),S=t(11978),A=t(87774),O=t(77069),k=t(1457),R=function(e){var n=e.t,t=e.onClose,o=e.discussionPreferences,i=o.loading,s=o.error,a=o.me,d=o.discussion,u=e.setDiscussionPreferences,c=e.autoCredential;return(0,r.jsx)(T.Overlay,{onClose:t,mUpStyle:{minHeight:240},children:(0,r.jsx)(T.Loader,{loading:i,error:s,message:n("components/DiscussionPreferences/loading"),render:function(){var e=a.credentials,o=d.rules,i=d.userPreference;return(0,r.jsx)(E,{t:n,credentials:e,rules:o,autoCredential:c,userPreference:i,onClose:t,setDiscussionPreferences:u,me:a})}})})};R.propTypes={discussionId:h().string.isRequired,onClose:h().func.isRequired,discussionPreferences:h().object.isRequired,setDiscussionPreferences:h().func.isRequired};var $,B;y()(C.Z,w.S)(R);var L={previewWrapper:(0,S.css)(($={borderBottomWidth:1,borderBottomStyle:"solid",padding:"0 ".concat(T.OverlayBody.PADDING,"px"),margin:"-".concat(T.OverlayBody.PADDING,"px -").concat(T.OverlayBody.PADDING,"px ").concat(T.OverlayBody.PADDING,"px")},(0,j.Z)($,T.mediaQueries.mUp,{marginTop:0,paddingBottom:T.OverlayBody.PADDING}),(0,j.Z)($,"& > p",{marginTop:0,marginBottom:10}),$)),commentHeaderWrapper:(0,S.css)((B={margin:"0px -20px",padding:20},(0,j.Z)(B,T.mediaQueries.mUp,{margin:0}),(0,j.Z)(B,"display","flex"),(0,j.Z)(B,"flexDirection","column"),(0,j.Z)(B,"& > *:not(:last-child)",{marginBottom:10}),B)),fieldWrapper:(0,S.css)({marginBottom:24,"& > *:not(:last-child)":{display:"block",marginBottom:10}}),suggestedCredentialsWrapper:(0,S.css)({"& > *:not(:last-child)":{marginBottom:10}}),suggestedCredentialsContainer:(0,S.css)({margin:"0 10",display:"flex",flexDirection:"column"})},E=function(e){var n,t=e.userPreference,o=e.autoCredential,i=e.t,a=e.credentials,d=e.rules,u=e.onClose,c=e.setDiscussionPreferences,l=e.me,m=(0,D.Z)((0,T.useColorContext)(),1)[0],p=(0,s.useState)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e.anonymity,o=void 0!==r&&r,i=e.credential;switch(!i&&t&&(i=t),n.anonymity){case"ALLOWED":break;case"FORBIDDEN":o=!1;break;case"ENFORCED":o=!0;break;default:console.warn("DiscussionPreferencesForm: unknown anonymity permission: ".concat(n.anonymity)),o=!1}return{anonymity:o,credential:i?i.description:null}}(t,d,o)),h=p[0],g=(0,s.useState)(h),y=g[0],C=g[1],x=(0,s.useState)(null),I=x[0],Z=x[1],w=(0,s.useState)(!1),R=w[0],$=w[1],B=function(){var e=(0,b.Z)((function(e){var n;return(0,P.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),Z(null),[4,c(e.anonymity,e.credential)];case 1:return t.sent(),u(),[3,3];case 2:return n=t.sent(),Z((0,O.V)(n)),[3,3];case 3:return[2]}}))}));return function(n){return e.apply(this,arguments)}}(),E=a.find((function(e){return e.description===y.credential})),H=E&&E.isListed,M=a.filter((function(e){return e.description!==y.credential})),N=(0,s.useMemo)((function(){return{credential:a.find((function(e){return e.description===y.credential}))||{description:y.credential},name:y.anonymity?i("discussion/displayUser/anonymous"):l.name,portrait:y.anonymity?void 0:l.portrait}}),[y.anonymity,y.credential,M,l]),_=(0,s.useMemo)((function(){return(0,S.css)({all:"unset",cursor:"pointer",padding:10,"@media(hover)":{":hover":{backgroundColor:m.getCSSColor("hover")}},"&:not(:last-child)":{borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:m.getCSSColor("divider")}})}),[m]);return(0,r.jsxs)("form",{onSubmit:function(e){e.preventDefault(),B(y)},children:[(0,r.jsx)(T.OverlayToolbar,{title:i("components/DiscussionPreferences/modalTitle"),onClose:u}),(0,r.jsxs)(T.OverlayBody,{children:[(0,r.jsx)("div",(0,v.Z)((0,f.Z)({},L.previewWrapper,m.set("borderBottomColor","divider")),{children:(0,r.jsxs)("div",(0,v.Z)((0,f.Z)({},L.commentHeaderWrapper,m.set("backgroundColor","hover")),{children:[(0,r.jsx)(T.Label,{children:i("components/DiscussionPreferences/profilePreview")}),(0,r.jsx)(T.CommentHeaderProfile,{t:i,displayAuthor:{name:N.name,profilePicture:N.portrait,credential:N.credential}})]}))})),(0,r.jsxs)("div",(0,v.Z)((0,f.Z)({},L.fieldWrapper),{children:[(0,r.jsx)(T.Interaction.H3,{children:i("components/DiscussionPreferences/credentialHeading")}),(0,r.jsx)(T.Label,{children:i("components/DiscussionPreferences/credential/description")}),(0,r.jsx)(T.Field,{label:i("components/DiscussionPreferences/credentialLabel"),error:(null===(n=y.credential)||void 0===n?void 0:n.length)>40&&i("components/DiscussionPreferences/credentialLabel/tooLong"),value:y.credential,onChange:function(e,n){C((function(e){return(0,v.Z)((0,f.Z)({},e),{credential:n})}))},showClearIcon:!0}),H&&y.anonymity&&(0,r.jsx)("div",{style:{marginBottom:10},children:(0,r.jsx)(T.Label,{children:i("components/DiscussionPreferences/credentialAnonymityWarning")})}),M&&M.length>0&&(0,r.jsxs)("div",(0,v.Z)((0,f.Z)({},L.suggestedCredentialsWrapper),{children:[(0,r.jsx)(T.Label,{children:i("components/DiscussionPreferences/existingCredentialLabel")}),(0,r.jsx)("div",(0,v.Z)((0,f.Z)({},L.suggestedCredentialsContainer),{children:M.slice(0,R?M.length-1:4).map((function(e){return(0,r.jsx)("button",(0,v.Z)((0,f.Z)({onClick:function(){return C((function(n){return(0,v.Z)((0,f.Z)({},n),{credential:e.description})}))}},_),{children:(0,r.jsx)(A.Z,(0,v.Z)((0,f.Z)({},e),{textColor:m.getCSSColor("text")}))}),e.description)}))})),!R&&M.length>=5&&(0,r.jsx)(T.A,{href:"#",onClick:function(e){e.preventDefault(),$(!0)},children:i("components/DiscussionPreferences/showAllCredentials")})]}))]})),"FORBIDDEN"!==d.anonymity&&(0,r.jsxs)("div",(0,v.Z)((0,f.Z)({},L.fieldWrapper),{children:[(0,r.jsx)(T.Interaction.H3,{children:i("components/DiscussionPreferences/commentAnonymously")}),(0,r.jsx)(T.Label,{children:i("components/DiscussionPreferences/commentAnonymously/description")}),(0,r.jsx)("div",{children:(0,r.jsx)(T.Checkbox,{disabled:"ALLOWED"!==(null===d||void 0===d?void 0:d.anonymity),checked:y.anonymity,onChange:function(e,n){C((function(e){return(0,v.Z)((0,f.Z)({},e),{anonymity:n,credential:n&&e.credential===h.credential?"":e.credential})}))},children:i("components/DiscussionPreferences/commentAnonymouslyLabel")})})]})),I&&(0,r.jsx)(k.ZP,{error:I}),(0,r.jsx)("div",(0,v.Z)((0,f.Z)({},(0,S.css)((0,j.Z)({width:"100%"},T.mediaQueries.mUp,{maxWidth:"max-content"}))),{children:(0,r.jsx)(T.Button,{type:"submit",block:!0,children:i("components/DiscussionPreferences/save")})}))]})]})},H=t(70370),M=t(26297),N=t(68762),_=t(62350),F=t(92228),V=t(57800),W=t(55215),U=t(69359);function q(){var e=(0,F.Z)(["\n  mutation featureCommentMutation(\n    $commentId: ID!\n    $content: String\n    $targets: [CommentFeaturedTarget!]\n  ) {\n    featureComment(id: $commentId, content: $content, targets: $targets) {\n      ...Comment\n    }\n  }\n  ","\n"]);return q=function(){return e},e}var z=(0,V.Ps)(q(),W.Z),G=(0,U.G2)(z),Q=["DEFAULT","MARKETING"],K=function(e){var n=e.t,t=e.targets,o=e.setTargets,i=e.targetKey;return(0,r.jsx)("div",(0,v.Z)((0,f.Z)({},J.checkbox),{children:(0,r.jsx)(T.Checkbox,{checked:t.includes(i),onChange:function(e,n){o(t.filter((function(e){return e!==i})).concat(n?i:[]))},children:n("FeatureCommentOverlay/".concat(i,"/add"))})}))},X=function(e){var n,t,o=e.comment,i=(0,C.$)().t,a=(0,Z.D)(),d=a.discussion,u=a.overlays.featureOverlay,c=(0,D.Z)(G(),1)[0],l=(0,s.useState)({}),m=l[0],p=l[1],h=(0,s.useState)(o.featuredTargets||[Q[0]]),g=h[0],y=h[1],x=(0,s.useState)(o.featuredText||o.text),I=x[0],b=x[1],j=(0,D.Z)((0,T.useColorContext)(),1)[0];return(0,r.jsxs)(T.Overlay,{onClose:u.handleClose,mUpStyle:{minHeight:0},children:[(0,r.jsx)(T.OverlayToolbar,{title:i("FeatureCommentOverlay/title"),onClose:u.handleClose}),(0,r.jsxs)(T.OverlayBody,{children:[(0,r.jsx)("div",{children:Q.map((function(e){return(0,r.jsx)(K,{targetKey:e,targets:g,setTargets:y,t:i},e)}))}),g.length?(0,r.jsx)(T.Field,{label:i("FeatureCommentOverlay/text/label"),renderInput:function(e){var n=e.ref,t=(0,M.Z)(e,["ref"]);return(0,r.jsx)(N.Z,(0,v.Z)((0,f.Z)({},t,_.W.autoSize),{inputRef:n}))},value:I,onChange:function(e,n,t){return b(n)}}):(0,r.jsx)(T.Interaction.P,(0,v.Z)((0,f.Z)({},j.set("color","textSoft")),{children:(0,r.jsx)("small",{children:(0,r.jsx)("em",{children:i("FeatureCommentOverlay/warning")})})})),m.error&&(0,r.jsx)(k.ZP,{error:m.error}),(0,r.jsx)(T.Button,{disabled:m.loading,primary:!0,type:"submit",onClick:function(){p({loading:!0}),c({variables:{commentId:o.id,content:g.length?I:null,targets:g}}).then((function(){u.handleClose()})).catch((function(e){p({error:e})}))},children:i("FeatureCommentOverlay/submit")}),(0,r.jsxs)("div",(0,v.Z)((0,f.Z)({},J.preview),{children:[g.includes("DEFAULT")&&(0,r.jsxs)("div",{children:[(0,r.jsx)(T.Label,{children:i("FeatureCommentOverlay/front/preview")}),(0,r.jsx)(T.ActiveDebateTeaser,{t:i,discussion:(0,v.Z)((0,f.Z)({},d),{comments:(0,v.Z)((0,f.Z)({},d.comments),{nodes:[(0,v.Z)((0,f.Z)({},o),{highlight:I})]})})})]}),g.includes("MARKETING")&&(0,r.jsxs)("div",{children:[(0,r.jsx)(T.Label,{children:i("FeatureCommentOverlay/marketing/preview")}),(0,r.jsx)(T.CommentTeaser,(0,v.Z)((0,f.Z)({},o),{featuredText:I,discussion:(0,v.Z)((0,f.Z)({},d),{image:null===d||void 0===d||null===(n=d.document)||void 0===n||null===(t=n.meta)||void 0===t?void 0:t.twitterImage}),t:i}))]})]}))]})]})},J={checkbox:(0,S.css)({display:"inline-block",marginRight:25}),preview:(0,S.css)({marginTop:30})},Y=t(28597),ee=function(e){var n=e.discussionId,t=e.parent,o=e.onClose,i=(0,C.$)().t;return(0,r.jsxs)(T.Overlay,{onClose:o,children:[(0,r.jsx)(T.OverlayToolbar,{title:i("RootCommentOverlay/title"),onClose:o}),(0,r.jsx)(T.OverlayBody,{style:{paddingTop:58},children:(0,r.jsx)(fe,{discussionId:n,parentId:t,includeParent:!0,children:(0,r.jsx)(Y.Z,{inRootCommentOverlay:!0})})})]})},ne=t(99330),te={isBoardRoot:h().bool},re=function(e){var n=e.isBoardRoot,t=(0,i.useRouter)(),o=(0,C.$)().t,s=(0,Z.D)(),a=s.id,d=s.discussion,u=s.overlays,c=u.shareOverlay,l=u.preferencesOverlay,m=u.featureOverlay,p=(0,H.Z)(a),h=p.preferences,g=p.loading,y=p.error,x=p.updateDiscussionPreferencesHandler;return(0,r.jsxs)(r.Fragment,{children:[l.open&&(0,r.jsx)(R,{t:o,discussionId:d.id,discussionPreferences:(0,v.Z)((0,f.Z)({},h),{loading:g,error:y}),setDiscussionPreferences:x,onClose:l.handleClose,autoCredential:l.data}),m.open&&(0,r.jsx)(X,{comment:m.data}),c.open&&(0,r.jsx)(I,{discussionId:d.id,onClose:c.handleClose,url:c.data,title:d.title}),n&&!!t.query.parent&&(0,r.jsx)(ee,{discussionId:d.id,parent:t.query.parent,onClose:function(){var e=(0,ne.x2)(d);return e&&t.push(e)}})]})};re.propTypes=te;var oe=re,ie=t(47713),se=function(e){var n=e.parentId,t=e.includeParent,o=(0,C.$)().t,i=(0,Z.D)(),s=i.discussion,a=i.loading,d=i.error;if(a||d||!s)return null;var u=s.comments.focus||t&&n&&s.comments.nodes.find((function(e){return e.id===n}));return u?(0,r.jsx)(ie.Z,{data:{title:o("discussion/meta/focus/title",{authorName:u.displayAuthor.name,quotedDiscussionTitle:(0,T.inQuotes)(s.title)}),description:u.preview?u.preview.string:void 0,url:(0,ne.No)(s,s.comments.focus)}}):null},ae=t(50930),de=t(33379),ue=t(94389);var ce=function(e){var n=(0,D.Z)((0,de.D)(ue.VP),1)[0],t=(0,s.useCallback)((function(){e&&(null===e||void 0===e?void 0:e.comments.nodes)&&0!==(null===e||void 0===e?void 0:e.comments.nodes.length)&&e.comments.nodes.reduce((function(e,n){var t=n.unreadNotifications;if(!t||!(null===t||void 0===t?void 0:t.nodes)||0===t.nodes.length)return e;var r=t.nodes.filter((function(e){return!e.readAt}));return(0,ae.Z)(e).concat((0,ae.Z)(r))}),[]).forEach((function(e){return n({variables:{id:e.id}})}))}),[null===e||void 0===e?void 0:e.comments,n]);(0,s.useEffect)((function(){(null===e||void 0===e?void 0:e.comments)&&t()}),[null===e||void 0===e?void 0:e.comments])},le=t(56995);var me=function(e){var n=(0,C.$)().t,t=(0,le.iS)().inNativeApp,r=m();return(0,v.Z)((0,f.Z)({},r),{shareHandler:function(o){return e?(t?(0,le.oi)({type:"share",payload:{title:e.title,url:(0,ne.No)(e,o),subject:n("discussion/share/emailSubject",{title:e.title},""),dialogTitle:n("article/share/title")}}):r.handleOpen((0,ne.No)(e,o)),Promise.resolve({ok:!0})):Promise.reject(new Error("No discussion loaded"))}})},fe=function(e){var n=e.children,t=e.discussionId,s=e.isBoardRoot,a=e.parentId,d=e.includeParent,u=(0,i.useRouter)().query,c=u.order||(s?"HOT":t===o.rC?"DATE":"AUTO"),f=u.tag,v=u.focus,p=s?1:3,h=l(t,{orderBy:c,activeTag:f,depth:p,focusId:v,parentId:a,includeParent:d}),g=h.discussion,y=h.error,C=h.loading,x=h.refetch,I=h.fetchMore;ce(g);var b={id:t,discussion:g,loading:C,error:y,fetchMore:I,refetch:x,focusId:v,orderBy:c,activeTag:f,depth:p,overlays:{shareOverlay:me(g),preferencesOverlay:m(),featureOverlay:m()}};return(0,r.jsx)(Z.Z.Provider,{value:b,children:(0,r.jsxs)("div",{"data-discussion-id":t,children:[n,g&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(oe,{isBoardRoot:s}),(0,r.jsx)(se,{parentId:a,includeParent:d})]})]})})}},41063:function(e,n,t){t.d(n,{T:function(){return u},r:function(){return c}});var r=t(92228),o=t(57800),i=t(75174),s=t(69359),a=t(55215);function d(){var e=(0,r.Z)(["\n  query discussion(\n    $discussionId: ID!\n    $parentId: ID\n    $after: String\n    $orderBy: DiscussionOrder!\n    $depth: Int!\n    $focusId: ID\n    $includeParent: Boolean\n    $activeTag: String\n  ) {\n    me {\n      id\n      name\n      portrait\n    }\n    discussion(id: $discussionId) {\n      ...Discussion\n      allComments: comments(\n        parentId: $parentId\n        after: $after\n        orderBy: $orderBy\n        first: 100\n        flatDepth: $depth\n        focusId: $focusId\n        includeParent: $includeParent\n      ) {\n        totalCount\n      }\n      comments(\n        parentId: $parentId\n        after: $after\n        orderBy: $orderBy\n        first: 100\n        flatDepth: $depth\n        focusId: $focusId\n        includeParent: $includeParent\n        tag: $activeTag\n      ) {\n        totalCount\n        resolvedOrderBy\n        directTotalCount\n        pageInfo {\n          hasNextPage\n          endCursor\n        }\n        focus {\n          id\n          parentIds\n          preview(length: 300) {\n            string\n          }\n          displayAuthor {\n            id\n            name\n          }\n        }\n        nodes {\n          ...Comment\n          comments {\n            totalCount\n            directTotalCount\n            pageInfo {\n              hasNextPage\n              endCursor\n            }\n          }\n        }\n      }\n    }\n  }\n  ","\n  ","\n"]);return d=function(){return e},e}var u=(0,o.Ps)(d(),i.O,a.Z),c=(0,s.L)(u)},95064:function(e,n,t){t.d(n,{U$:function(){return d},rX:function(){return s},vu:function(){return c}});var r=t(70865),o=t(96670),i=t(50930),s=function(e){var n=e.comment,t=e.initialParentId,i=e.activeTag;return function(e){var s;if(d({comment:n,initialParentId:t})(e),u({comment:n,initialParentId:t})(e),!i||!(null===(s=n.tags)||void 0===s?void 0:s.length)||n.tags.find((function(e){return e===i}))){var a=n.parentIds[n.parentIds.length-1],c=e.discussion.comments.nodes,m=c.findIndex((function(e){return e.id===n.id}));-1!==m&&e.discussion.comments.nodes.splice(m,1);var f=1+c.findIndex((function(e){return e.id===a}));e.discussion.comments.nodes.splice(f,0,(0,o.Z)((0,r.Z)({},n),{comments:l}))}}},a=new Set,d=function(e){var n=e.comment,t=e.initialParentId;return function(e){var r=n.content.optimistic,o=n.parentIds[n.parentIds.length-1],i=e.discussion.comments.nodes,s="dc-".concat(n.id,"-").concat(t);a.has(s)||(e.discussion.comments.totalCount+=1,e.discussion.allComments.totalCount+=1,o||(e.discussion.comments.directTotalCount+=1)),r||a.add(s);var d=!0,u=!1,c=void 0;try{for(var l,m=function(){var e=l.value,t=i.find((function(n){return n.id===e}));if(t){var s="c-".concat(n.id,"-").concat(t.id);a.has(s)||(t.comments.totalCount+=1,t.id===o&&(t.comments.directTotalCount+=1)),r||a.add(s)}},f=n.parentIds[Symbol.iterator]();!(d=(l=f.next()).done);d=!0)m()}catch(v){u=!0,c=v}finally{try{d||null==f.return||f.return()}finally{if(u)throw c}}}},u=function(e){var n=e.comment;e.initialParentId;return function(e){var t=e.discussion.comments.nodes,r=n.parentIds[0],o=r?t.find((function(e){return e.id===r})):n,i=null===o||void 0===o?void 0:o.tags;if(null===i||void 0===i?void 0:i.length){var s=!0,a=!1,d=void 0;try{for(var u,c=function(){var n,t=u.value,r=null===(n=e.discussion.tagBuckets)||void 0===n?void 0:n.find((function(e){return e.value===t}));r&&(r.count+=1)},l=i[Symbol.iterator]();!(s=(u=l.next()).done);s=!0)c()}catch(m){a=!0,d=m}finally{try{s||null==l.return||l.return()}finally{if(a)throw d}}}}},c=function(e){var n=e.parentId,t=e.appendAfter,s=e.comments;return function(e){var a=e.discussion.comments.nodes,d=new Map(a.map((function(e,n){return[e.id,n]}))),u=s.nodes.filter((function(e){return!d.has(e.id)}));if(n){var c,l=d.get(n);e.discussion.comments.nodes[l].comments=(0,r.Z)({},s);var m=t&&d.has(t)?d.get(t)+1:l+1;(c=e.discussion.comments.nodes).splice.apply(c,[m,0].concat((0,i.Z)(u)))}else e.discussion.comments=(0,o.Z)((0,r.Z)({},s),{nodes:a.concat(u)})}},l={__typename:"CommentConnection",totalCount:0,directTotalCount:0,pageInfo:{__typename:"PageInfo",hasNextPage:!1,endCursor:null},nodes:[]}},70370:function(e,n,t){var r=t(98788),o=t(87394),i=t(5163),s=t(33379),a=t(22917),d=t(57956),u=t(36323);n.Z=function(e){var n=(0,u.B)({variables:{discussionId:e}}),t=n.data,c=n.loading,l=n.error,m=n.refetch,f=(0,o.Z)((0,s.D)(a.yv),1)[0];function v(){return(v=(0,r.Z)((function(n,t,r){return(0,i.__generator)(this,(function(o){return[2,f({variables:{discussionId:e,discussionPreferences:{anonymity:n,credential:(null===t||void 0===t?void 0:t.trim())||null,notifications:r}}}).then((function(e){return m().then((function(){return e}))})).catch(d.C)]}))}))).apply(this,arguments)}return{preferences:t,loading:c,error:l,updateDiscussionPreferencesHandler:function(e,n,t){return v.apply(this,arguments)}}}},82770:function(e,n,t){t.d(n,{MZ:function(){return u}});var r=t(70865),o=t(26297),i=t(52322),s=t(37365),a=t(39097),d=t.n(a),u=function(e,n){var t=e.pathname,i=(e.query.focus,(0,o.Z)(e.query,["focus"])),s=(0,r.Z)({},i,n);return["tag","order"].forEach((function(e){void 0===s[e]&&delete s[e]})),{pathname:t,query:s}};n.ZP=function(e){var n=e.children,t=function(e){var n;if(e&&e.document){var t=e.document.meta||{},r=t.ownDiscussion&&!t.ownDiscussion.closed,o=t.template;n=r&&"article"===o&&"article"}return(n=n||e&&e.id===s.rC&&"general")?{pathname:"/dialog",query:{t:n,id:"general"===n?void 0:e.id}}:e?{pathname:e.document&&e.document.meta&&e.document.meta.path?e.document.meta.path:e.path,query:{}}:void 0}(e.discussion);return t?(0,i.jsx)(d(),{href:t,passHref:!0,prefetch:!1,children:n}):n}},62350:function(e,n,t){t.d(n,{W:function(){return l}});var r=t(70865),o=t(96670),i=t(26297),s=t(52322),a=t(11978),d=t(68762),u=t(70460),c=t(85313),l={mask:(0,a.css)({"::placeholder":{color:"transparent"},":focus":{"::placeholder":{color:"#ccc"}}}),autoSize:(0,a.css)({minHeight:40,paddingTop:"7px !important",paddingBottom:"6px !important",background:"transparent"})},m=function(e){return(0,s.jsx)(c.FieldSet,(0,o.Z)((0,r.Z)({},e),{additionalFieldProps:function(n){var t,a=e.additionalFieldProps?e.additionalFieldProps(n):{};n.autoSize&&(t=function(e){var n=e.ref,t=(0,i.Z)(e,["ref"]);return(0,s.jsx)(d.Z,(0,o.Z)((0,r.Z)({},l.autoSize,t),{inputRef:n}))},a.renderInput=t);return n.mask&&(a.renderInput=function(e){return(0,s.jsx)(u.Z,(0,o.Z)((0,r.Z)({},e,l.mask),{placeholderChar:n.maskChar||" ",mask:n.mask}))}),a}}))};m.utils=c.FieldSet.utils,n.Z=m}}]);